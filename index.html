<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="algebrain.dev - Fun multiplication, addition, and subtraction games for kids">
  <title>algebrain.dev - Choose Your Adventure</title>

  <!-- PWA Meta Tags -->
  <meta name="theme-color" content="#667eea">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="algebrain">

  <!-- PWA Manifest -->
  <link rel="manifest" href="/manifest.json">

  <!-- Icons -->
  <link rel="icon" type="image/png" sizes="32x32" href="/icons/icon-96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icons/icon-72.png">
  <link rel="apple-touch-icon" href="/icons/icon-192.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/icon-152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/icon-192.png">
  <link rel="apple-touch-icon" sizes="167x167" href="/icons/icon-192.png">

  <link rel="stylesheet" href="shared/styles/common.css">

  <!-- Storage utilities -->
  <script src="shared/utils/storage.js"></script>

  <!-- PWA Support -->
  <script src="shared/utils/pwa.js"></script>

  <style>
    body {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: var(--space-4);
    }

    .main-container {
      max-width: 1000px;
      width: 100%;
    }

    .hero {
      text-align: center;
      margin-bottom: var(--space-10);
      color: white;
    }

    .hero h1 {
      font-size: var(--font-size-4xl);
      margin-bottom: var(--space-4);
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
    }

    .hero p {
      font-size: var(--font-size-xl);
      opacity: 0.95;
      margin-bottom: 0;
    }

    .games-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: var(--space-6);
      margin-bottom: var(--space-8);
    }

    .game-card {
      background: var(--color-surface);
      border-radius: var(--radius-xl);
      padding: var(--space-8);
      box-shadow: var(--shadow-xl);
      transition: all var(--transition-base);
      text-decoration: none;
      color: inherit;
      display: flex;
      flex-direction: column;
      align-items: center;
      text-align: center;
      border: 3px solid transparent;
    }

    .game-card:hover {
      transform: translateY(-8px);
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.2);
      border-color: var(--color-primary);
    }

    .game-icon {
      font-size: 4rem;
      margin-bottom: var(--space-4);
    }

    .game-title {
      font-size: var(--font-size-2xl);
      font-weight: var(--font-weight-bold);
      color: var(--color-primary);
      margin-bottom: var(--space-3);
    }

    .game-description {
      color: var(--color-text-secondary);
      margin-bottom: var(--space-4);
      line-height: var(--line-height-relaxed);
    }

    .game-features {
      list-style: none;
      padding: 0;
      margin: var(--space-4) 0;
      text-align: left;
      width: 100%;
    }

    .game-features li {
      padding: var(--space-2) 0;
      color: var(--color-text-secondary);
      font-size: var(--font-size-sm);
    }

    .game-features li::before {
      content: "âœ“";
      color: var(--color-success);
      font-weight: bold;
      margin-right: var(--space-2);
    }

    .play-button {
      background: var(--color-primary);
      color: white;
      padding: var(--space-4) var(--space-8);
      border-radius: var(--radius-lg);
      font-weight: var(--font-weight-semibold);
      margin-top: auto;
      transition: all var(--transition-fast);
    }

    .game-card:hover .play-button {
      background: var(--color-primary-dark);
      transform: scale(1.05);
    }

    .info-section {
      background: rgba(255, 255, 255, 0.95);
      border-radius: var(--radius-xl);
      padding: var(--space-6);
      text-align: center;
      box-shadow: var(--shadow-lg);
    }

    .info-section h2 {
      color: var(--color-primary);
      margin-bottom: var(--space-4);
    }

    .info-section p {
      color: var(--color-text-secondary);
      line-height: var(--line-height-relaxed);
      margin-bottom: var(--space-4);
    }

    .info-section ul {
      list-style: none;
      padding: 0;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: var(--space-4);
      text-align: left;
    }

    .info-section li {
      padding-left: var(--space-6);
      position: relative;
      color: var(--color-text-secondary);
    }

    .info-section li::before {
      content: "ðŸ“š";
      position: absolute;
      left: 0;
    }

    @media (max-width: 767px) {
      .hero h1 {
        font-size: var(--font-size-3xl);
      }

      .hero p {
        font-size: var(--font-size-lg);
      }

      .games-grid {
        grid-template-columns: 1fr;
      }
    }

    /* Player Setup Modal */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.7);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      padding: var(--space-4);
    }

    .modal-overlay.hidden {
      display: none;
    }

    .modal-content {
      background: var(--color-surface);
      border-radius: var(--radius-xl);
      padding: var(--space-8);
      max-width: 500px;
      width: 100%;
      box-shadow: var(--shadow-2xl);
      text-align: center;
    }

    .modal-content h2 {
      color: var(--color-primary);
      margin-bottom: var(--space-4);
      font-size: var(--font-size-2xl);
    }

    .modal-content p {
      color: var(--color-text-secondary);
      margin-bottom: var(--space-6);
      line-height: var(--line-height-relaxed);
    }

    .player-input-group {
      margin-bottom: var(--space-6);
    }

    .player-input-group label {
      display: block;
      font-weight: var(--font-weight-semibold);
      color: var(--color-text);
      margin-bottom: var(--space-2);
      text-align: left;
    }

    .player-input-group input {
      width: 100%;
      padding: var(--space-4);
      font-size: var(--font-size-lg);
      border: 2px solid var(--color-border);
      border-radius: var(--radius-lg);
      transition: all var(--transition-base);
    }

    .player-input-group input:focus {
      outline: none;
      border-color: var(--color-primary);
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }

    .modal-actions {
      display: flex;
      gap: var(--space-4);
    }

    .modal-actions .btn {
      flex: 1;
      padding: var(--space-4);
      font-size: var(--font-size-lg);
      font-weight: var(--font-weight-semibold);
      border-radius: var(--radius-lg);
      border: none;
      cursor: pointer;
      transition: all var(--transition-fast);
    }

    .btn-primary {
      background: var(--color-primary);
      color: white;
    }

    .btn-primary:hover {
      background: var(--color-primary-dark);
      transform: translateY(-2px);
      box-shadow: var(--shadow-md);
    }

    .btn-primary:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }

    .error-message {
      color: var(--color-error);
      font-size: var(--font-size-sm);
      margin-top: var(--space-2);
      text-align: left;
    }

    .player-welcome {
      background: rgba(255, 255, 255, 0.95);
      border-radius: var(--radius-lg);
      padding: var(--space-4) var(--space-6);
      margin-bottom: var(--space-6);
      display: flex;
      align-items: center;
      justify-content: space-between;
      box-shadow: var(--shadow-md);
    }

    .player-welcome-text {
      color: var(--color-text);
      font-size: var(--font-size-lg);
      font-weight: var(--font-weight-semibold);
    }

    .player-welcome-text span {
      color: var(--color-primary);
    }

    .btn-change-player {
      background: transparent;
      border: 2px solid var(--color-primary);
      color: var(--color-primary);
      padding: var(--space-2) var(--space-4);
      border-radius: var(--radius-md);
      cursor: pointer;
      font-weight: var(--font-weight-semibold);
      transition: all var(--transition-fast);
    }

    .btn-change-player:hover {
      background: var(--color-primary);
      color: white;
    }

    .footer {
      text-align: center;
      margin-top: var(--space-8);
      padding-top: var(--space-6);
    }

    .footer a {
      color: rgba(255, 255, 255, 0.9);
      text-decoration: none;
      font-size: var(--font-size-sm);
      transition: all var(--transition-fast);
      padding: var(--space-2) var(--space-4);
      border-radius: var(--radius-md);
    }

    .footer a:hover {
      color: white;
      background: rgba(255, 255, 255, 0.1);
    }
  </style>
</head>
<body>
  <!-- Player Setup Modal -->
  <div class="modal-overlay" id="player-modal">
    <div class="modal-content">
      <h2>ðŸŽ® Welcome to algebrain.dev!</h2>
      <p>Choose a nickname</p>

      <div class="player-input-group">
        <label for="player-name">Nickname:</label>
        <input
          type="text"
          id="player-name"
          placeholder="Enter a nickname..."
          maxlength="20"
          autocomplete="off"
        >
        <div class="error-message" id="name-error"></div>
      </div>

      <p style="font-size: var(--font-size-sm); color: var(--color-text-secondary); margin-top: var(--space-4);">
        Your data stays on your device. <a href="privacy.html" style="color: var(--color-primary); text-decoration: underline;">Privacy info</a>
      </p>

      <div class="modal-actions">
        <button class="btn btn-primary" id="start-playing-btn">
          Start Playing! ðŸš€
        </button>
      </div>
    </div>
  </div>

  <div class="main-container animate-slideUp">
    <!-- Player Welcome Bar -->
    <div class="player-welcome" id="player-welcome" style="display: none;">
      <div class="player-welcome-text">
        Welcome back, <span id="current-player-name"></span>!
      </div>
      <button class="btn-change-player" id="change-player-btn">
        Change Player
      </button>
    </div>

    <div class="hero">
      <h1>ðŸŽ® algebrain.dev</h1>
      <p>Master multiplication, addition, and subtraction through fun gameplay!</p>
    </div>

    <div class="games-grid">
      <!-- Memory Match -->
      <a href="games/memory-match/index.html" class="game-card">
        <div class="game-icon">ðŸ§ </div>
        <h2 class="game-title">Memory Match</h2>
        <p class="game-description">
          Match hidden math problems with visible answers in this memory challenge!
        </p>
        <ul class="game-features">
          <li>3Ã—4 grid of problem cards</li>
          <li>3Ã—4 grid of answer cards</li>
          <li>Match all pairs before time runs out</li>
          <li>Perfect for memory training</li>
        </ul>
        <div class="play-button">Start Matching ðŸ§ </div>
      </a>

      <!-- Math Blitz -->
      <a href="games/math-blitz/index.html" class="game-card">
        <div class="game-icon">âš¡</div>
        <h2 class="game-title">Math Blitz</h2>
        <p class="game-description">
          Lightning-fast one-question-at-a-time challenge with streak tracking!
        </p>
        <ul class="game-features">
          <li>Full-screen focus mode</li>
          <li>Build answer streaks</li>
          <li>Speed bonus indicators</li>
          <li>Perfect for concentration</li>
        </ul>
        <div class="play-button">Start Blitz âš¡</div>
      </a>

      <!-- Number Ninja -->
      <a href="games/number-ninja/index.html" class="game-card">
        <div class="game-icon">ðŸ¥·</div>
        <h2 class="game-title">Number Ninja</h2>
        <p class="game-description">
          Gamified math training with combos, multipliers, and achievement badges!
        </p>
        <ul class="game-features">
          <li>Combo system with multipliers</li>
          <li>Unlock achievements</li>
          <li>Particle effects & animations</li>
          <li>Perfect for game lovers</li>
        </ul>
        <div class="play-button">Begin Training ðŸ¥·</div>
      </a>
    </div>

    <div class="info-section">
      <h2>ðŸŽ¯ What You'll Practice</h2>
      <p>
        All three games help you master the same skills with different gameplay styles.
        Choose the one that matches your learning preference!
      </p>
      <ul>
        <li>Multiplication tables 2-12</li>
        <li>Addition with 2-3 digit numbers</li>
        <li>Subtraction with 2-3 digit numbers</li>
        <li>Three difficulty levels each</li>
        <li>Track scores on leaderboards</li>
        <li>100% browser-based, no login needed</li>
      </ul>
    </div>

    <div class="footer">
      <a href="privacy.html">Privacy Information</a>
    </div>
  </div>

  <script>
    // Player setup and management
    document.addEventListener('DOMContentLoaded', () => {
      const modal = document.getElementById('player-modal');
      const playerWelcome = document.getElementById('player-welcome');
      const playerNameInput = document.getElementById('player-name');
      const startPlayingBtn = document.getElementById('start-playing-btn');
      const changePlayerBtn = document.getElementById('change-player-btn');
      const nameError = document.getElementById('name-error');
      const currentPlayerName = document.getElementById('current-player-name');

      // Check if player is already set
      const existingPlayer = PlayerStorage.getCurrentPlayer();

      if (existingPlayer) {
        // Hide modal and show welcome bar
        modal.classList.add('hidden');
        playerWelcome.style.display = 'flex';
        currentPlayerName.textContent = existingPlayer;
      } else {
        // Show modal for first-time user
        modal.classList.remove('hidden');
        playerWelcome.style.display = 'none';
      }

      // Handle player name submission
      const submitPlayerName = () => {
        const name = playerNameInput.value.trim();

        if (!name) {
          nameError.textContent = 'Please enter a nickname';
          playerNameInput.focus();
          return;
        }

        if (name.length < 2) {
          nameError.textContent = 'Nickname must be at least 2 characters';
          playerNameInput.focus();
          return;
        }

        // Save player name
        try {
          console.log('Setting player name:', name);
          const savedName = PlayerStorage.setCurrentPlayer(name);
          console.log('Player name saved:', savedName);
          console.log('localStorage check:', localStorage.getItem('algebrain_dev_current_player'));
          modal.classList.add('hidden');
          playerWelcome.style.display = 'flex';
          currentPlayerName.textContent = name;
          nameError.textContent = '';
        } catch (error) {
          console.error('Error saving player:', error);
          nameError.textContent = error.message;
        }
      };

      // Start playing button
      startPlayingBtn.addEventListener('click', submitPlayerName);

      // Enter key to submit
      playerNameInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
          submitPlayerName();
        }
      });

      // Clear error on input
      playerNameInput.addEventListener('input', () => {
        nameError.textContent = '';
      });

      // Change player button
      changePlayerBtn.addEventListener('click', () => {
        modal.classList.remove('hidden');
        playerNameInput.value = '';
        playerNameInput.focus();
        nameError.textContent = '';
      });

      // Focus input when modal is shown
      if (!existingPlayer) {
        playerNameInput.focus();
      }
    });
  </script>
</body>
</html>
